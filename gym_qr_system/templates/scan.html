<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>فحص QR بالكاميرا</title>
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
</head>
<body>
  <h1>فحص QR بالكاميرا</h1>

  <!-- كاميرا -->
  <div id="reader" style="width:300px;"></div>

  <form method="post" id="scan-form">
    <input type="text" name="barcode" id="barcode-input" required hidden>
  </form>

  <!-- الرسائل -->
  {% with messages = get_flashed_messages() %}
    {% if messages %}
      <ul>
        {% for msg in messages %}
          <li>{{ msg }}</li>
        {% endfor %}
      </ul>
    {% endif %}
  {% endwith %}

  <!-- بيانات العميل -->
  {% if client %}
    <h2>بيانات العميل</h2>
    <p>الاسم: {{ client.name }}</p>
    <p>الهاتف: {{ client.phone }}</p>
    <p>نوع الاشتراك: {{ client.subscription_type }}</p>
    <p>المدة المتبقية: {{ client.remaining }} يوم</p>
    <a href="{{ url_for('edit', id=client.id) }}">تعديل البيانات</a>
  {% endif %}

  <script>
    function onScanSuccess(decodedText, decodedResult) {
      document.getElementById("barcode-input").value = decodedText;
      document.getElementById("scan-form").submit();
    }

    let html5QrcodeScanner = new Html5QrcodeScanner(
      "reader", { fps: 10, qrbox: 250 });

    html5QrcodeScanner.render(onScanSuccess);
  </script>
</body>
</html>
